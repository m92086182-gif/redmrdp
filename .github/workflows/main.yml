name: Windows 10 Admin Session

on:
  workflow_dispatch:
    inputs:
      duration:
        description: 'Ù…Ø¯Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ (Ø³Ø§Ø¹Ø§Øª)'
        required: true
        default: '6'
        type: choice
        options:
          - '2'
          - '6'
          - '12'
          - '24'

jobs:
  windows-admin:
    runs-on: windows-latest
    timeout-minutes: ${{ fromJson('{"2": 120, "6": 360, "12": 720, "24": 1440}[github.event.inputs.duration] || 360') }}

    steps:
    - name: ğŸ” Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø§Ø¯Ù…Ù†
      run: |
        # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù†Ù†Ø§ Ù…Ø³Ø¤ÙˆÙ„ÙŠÙ†
        $currentPrincipal = New-Object Security.Principal.WindowsPrincipal([Security.Principal.WindowsIdentity]::GetCurrent())
        $isAdmin = $currentPrincipal.IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)
        Write-Host "âœ… ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„: $isAdmin"
        
        if (-not $isAdmin) {
            Write-Host "âŒ Ù„Ø§ ØªØ¹Ù…Ù„ Ø¨ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„"
            exit 1
        }

    - name: ğŸ–¥ï¸ Ø¹Ø±Ø¶ Ù…ÙˆØ§ØµÙØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
      run: |
        Write-Host "=== ğŸ–¥ï¸ Ù…ÙˆØ§ØµÙØ§Øª Ø§Ù„Ø³ÙŠØ±ÙØ± ==="
        systeminfo | findstr /C:"OS Name" /C:"OS Version" /C:"System Type"
        systeminfo | findstr /C:"Total Physical Memory" /C:"Available Physical Memory"
        systeminfo | findstr /C:"Processor(s)"
        Write-Host "=========================="

    - name: ğŸ’¾ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³Ø§Ø­Ø§Øª
      run: |
        Write-Host "=== ğŸ’¾ Ø§Ù„Ù…Ø³Ø§Ø­Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø© ==="
        Get-PSDrive -PSProvider FileSystem | Format-Table Name, Used, Free, Root
        Write-Host "=========================="

    - name: ğŸ”§ ØªØ«Ø¨ÙŠØª Ø¨Ø±Ø§Ù…Ø¬ Ø¥Ø¶Ø§ÙÙŠØ©
      run: |
        Write-Host "=== ğŸ”§ ØªØ«Ø¨ÙŠØª Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ ==="
        
        # ØªØ«Ø¨ÙŠØª Google Chrome
        Write-Host "Ø¬Ø§Ø±ÙŠ ØªØ«Ø¨ÙŠØª Chrome..."
        $chromeInstaller = "$env:TEMP\chrome_installer.exe"
        try {
            Invoke-WebRequest "https://dl.google.com/chrome/install/latest/chrome_installer.exe" -OutFile $chromeInstaller
            Start-Process -FilePath $chromeInstaller -Args "/silent /install" -Wait
            Remove-Item $chromeInstaller -Force
            Write-Host "âœ… Chrome installed"
        } catch {
            Write-Host "âš ï¸ ÙØ´Ù„ ØªØ«Ø¨ÙŠØª Chrome"
        }

        # ØªØ«Ø¨ÙŠØª 7-Zip
        Write-Host "Ø¬Ø§Ø±ÙŠ ØªØ«Ø¨ÙŠØª 7-Zip..."
        $7zipInstaller = "$env:TEMP\7zip.exe"
        try {
            Invoke-WebRequest "https://www.7-zip.org/a/7z2408-x64.exe" -OutFile $7zipInstaller
            Start-Process -FilePath $7zipInstaller -Args "/S" -Wait
            Remove-Item $7zipInstaller -Force
            Write-Host "âœ… 7-Zip installed"
        } catch {
            Write-Host "âš ï¸ ÙØ´Ù„ ØªØ«Ø¨ÙŠØª 7-Zip"
        }

    - name: ğŸ“‚ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯Ø§Øª Ø¹Ù…Ù„
      run: |
        Write-Host "=== ğŸ“‚ Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø¬Ù„Ø¯Ø§Øª Ø§Ù„Ø¹Ù…Ù„ ==="
        
        # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯Ø§Øª
        $workspace = "C:\GitHubWorkspace"
        New-Item -ItemType Directory -Path "$workspace\Projects" -Force
        New-Item -ItemType Directory -Path "$workspace\Downloads" -Force
        New-Item -ItemType Directory -Path "$workspace\Temp" -Force
        
        # Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­ØªÙˆÙŠØ§Øª
        Get-ChildItem C:\ -Depth 1 | Format-Table Name, LastWriteTime
        Write-Host "âœ… Ù…Ø¬Ù„Ø¯Ø§Øª Ø§Ù„Ø¹Ù…Ù„ Ø¬Ø§Ù‡Ø²Ø©"

    - name: ğŸŒ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª
      run: |
        Write-Host "=== ğŸŒ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ ==="
        
        # Ø§Ø®ØªØ¨Ø§Ø± Ù…ÙˆØ§Ù‚Ø¹ Ù…Ø®ØªÙ„ÙØ©
        $sites = @("google.com", "github.com", "microsoft.com")
        foreach ($site in $sites) {
            $result = Test-NetConnection -ComputerName $site -Port 80 -InformationLevel Quiet
            Write-Host "ğŸŒ $site : $(if($result){'âœ…' }else{'âŒ'})"
        }

    - name: âš™ï¸ Ø¹Ø±Ø¶ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
      run: |
        Write-Host "=== âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… ==="
        
        # Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø¨ÙƒØ©
        Write-Host "ğŸ“¡ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø¨ÙƒØ©:"
        ipconfig | findstr "IPv4"
        
        # Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª
        Write-Host "ğŸ‘¤ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:"
        whoami
        
        # Ø¹Ø±Ø¶ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦ÙŠØ©
        Write-Host "ğŸ”§ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦ÙŠØ©:"
        Get-ChildItem Env: | Where-Object Name -like "*GITHUB*" | Format-Table Name, Value

    - name: ğŸ¯ Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©
      run: |
        $duration = ${{ github.event.inputs.duration }}
        $endTime = (Get-Date).AddHours($duration)
        
        Write-Host ""
        Write-Host "=" * 70
        Write-Host "ğŸ¯ WINDOWS 10 ADMIN SESSION - Ø¬Ù„Ø³Ø© ÙˆÙŠÙ†Ø¯ÙˆØ² Ø¨ØµÙ„Ø§Ø­ÙŠØ§Øª Ù…Ø³Ø¤ÙˆÙ„"
        Write-Host "=" * 70
        Write-Host "â° Ø§Ù„Ù…Ø¯Ø©: $duration Ø³Ø§Ø¹Ø©"
        Write-Host "ğŸ’» Ø§Ù„Ù†Ø¸Ø§Ù…: Windows 10"
        Write-Host "ğŸ”‘ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª: Administrator"
        Write-Host "ğŸ“ Ù…Ø¬Ù„Ø¯ Ø§Ù„Ø¹Ù…Ù„: C:\GitHubWorkspace"
        Write-Host "=" * 70
        Write-Host "ğŸ”§ Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„Ù…Ø«Ø¨ØªØ©: Chrome, 7-Zip"
        Write-Host "ğŸŒ Ø§Ù„Ø§ØªØµØ§Ù„: Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª"
        Write-Host "=" * 70
        Write-Host ""

        $counter = 0
        while ((Get-Date) -lt $endTime) {
            $counter++
            $timeLeft = $endTime - (Get-Date)
            $hoursLeft = [math]::Round($timeLeft.TotalHours, 2)
            
            if ($counter % 5 -eq 0) {
                Write-Host "[$(Get-Date)] ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ø¸Ø§Ù…..."
                
                # Ø¹Ø±Ø¶ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø°Ø§ÙƒØ±Ø©
                $memory = Get-WmiObject Win32_OperatingSystem
                $usedMemory = [math]::Round(($memory.TotalVisibleMemorySize - $memory.FreePhysicalMemory) / 1MB, 2)
                $totalMemory = [math]::Round($memory.TotalVisibleMemorySize / 1MB, 2)
                
                Write-Host "   ğŸ’¾ Ø§Ù„Ø°Ø§ÙƒØ±Ø©: $usedMemory/$totalMemory GB"
                Write-Host "   ğŸ“‚ Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø­Ø±Ø©:"
                Get-PSDrive C | Format-Table Used, Free
            }
            
            Write-Host "[$(Get-Date)] âœ… Ø§Ù„Ø¬Ù„Ø³Ø© Ù†Ø´Ø·Ø© - $hoursLeft Ø³Ø§Ø¹Ø© Ù…ØªØ¨Ù‚ÙŠØ©"
            Start-Sleep -Seconds 60
        }
        
        Write-Host "â° Ø§Ù†ØªÙ‡Øª Ù…Ø¯Ø© Ø§Ù„Ø¬Ù„Ø³Ø©"

    - name: ğŸ§¹ Ø§Ù„ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
      if: always()
      run: |
        Write-Host "ğŸ§¹ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ†Ø¸ÙŠÙ..."
        # ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø¤Ù‚ØªØ©
        Remove-Item "C:\GitHubWorkspace" -Recurse -Force -ErrorAction SilentlyContinue
        Write-Host "âœ… ØªÙ… Ø§Ù„ØªÙ†Ø¸ÙŠÙ"
