name: Windows RDP with LocalTunnel

on:
  workflow_dispatch:

jobs:
  rdp-localtunnel:
    runs-on: windows-latest
    timeout-minutes: 360

    steps:
    - name: Setup RDP Server
      run: |
        # ØªÙØ¹ÙŠÙ„ RDP
        Set-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\Terminal Server" -Name "fDenyTSConnections" -Value 0 -Force
        Set-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" -Name "UserAuthentication" -Value 0 -Force
        netsh advfirewall firewall add rule name="RDP" dir=in action=allow protocol=TCP localport=3389
        
        # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªØ®Ø¯Ù…
        $password = "P@ssw0rd123"
        $securePassword = ConvertTo-SecureString $password -AsPlainText -Force
        New-LocalUser -Name "RDPUser" -Password $securePassword -AccountNeverExpires
        Add-LocalGroupMember -Group "Administrators" -Member "RDPUser"
        Add-LocalGroupMember -Group "Remote Desktop Users" -Member "RDPUser"
        
        echo "RDP_PASS=$password" >> $env:GITHUB_ENV
        Write-Host "âœ… ØªÙ… Ø¥Ø¹Ø¯Ø§Ø¯ RDP Ø§Ù„Ø³ÙŠØ±ÙØ±"

    - name: Display Important Info
      run: |
        Write-Host ""
        Write-Host "ğŸš¨ Ù…Ù‡Ù…: GitHub Actions Ù„Ø§ ØªØ³Ù…Ø­ Ø¨Ø§ØªØµØ§Ù„Ø§Øª RDP Ù…Ø¨Ø§Ø´Ø±Ø©"
        Write-Host ""
        Write-Host "ğŸ¯ Ù„ÙƒÙ† ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù…:"
        Write-Host "   1. VPS Ø­Ù‚ÙŠÙ‚ÙŠ (Ù…Ø³ØªØ­Ø³Ù†)"
        Write-Host "   2. Ø¬Ù‡Ø§Ø²Ùƒ Ø§Ù„Ø´Ø®ØµÙŠ ÙƒØ³ÙŠØ±ÙØ±"
        Write-Host "   3. Ø®Ø¯Ù…Ø§Øª cloud Ù…Ø¬Ø§Ù†ÙŠØ©"
        Write-Host ""
        Write-Host "ğŸ”§ RDP Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¬Ø§Ù‡Ø²Ø© Ø¯Ø§Ø®Ù„ÙŠØ§Ù‹:"
        Write-Host "   ğŸ‘¤ User: RDPUser"
        Write-Host "   ğŸ”‘ Pass: $env:RDP_PASS"
        Write-Host "   ğŸšª Port: 3389"
        Write-Host ""

    - name: Keep Active
      run: |
        $startTime = Get-Date
        while ($true) {
            $elapsed = (Get-Date) - $startTime
            $hours = [math]::Round($elapsed.TotalHours, 1)
            
            Write-Host "[$(Get-Date)] â³ RDP Server Ready (Internal Only)"
            Write-Host "   â° Running for: $hours hours"
            Write-Host "   ğŸ‘¤ User: RDPUser | ğŸ”‘ Pass: $env:RDP_PASS"
            Write-Host "   ğŸ’¡ Use VPS for external access"
            Write-Host ""
            
            Start-Sleep -Seconds 60
        }
