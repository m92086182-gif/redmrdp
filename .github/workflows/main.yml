name: Windows 10 Admin Session

on:
  workflow_dispatch:
    inputs:
      duration:
        description: 'ŸÖÿØÿ© ÿßŸÑÿ™ÿ¥ÿ∫ŸäŸÑ (ÿ≥ÿßÿπÿßÿ™)'
        required: true
        default: '6'
        type: choice
        options:
          - '2'
          - '6'
          - '12'
          - '24'

jobs:
  windows-admin:
    runs-on: windows-latest
    timeout-minutes: 360

    steps:
    - name: Check Admin Privileges
      run: |
        $currentPrincipal = New-Object Security.Principal.WindowsPrincipal([Security.Principal.WindowsIdentity]::GetCurrent())
        $isAdmin = $currentPrincipal.IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)
        Write-Host "Admin Privileges: $isAdmin"
        
        if (-not $isAdmin) {
            Write-Host "Not running as Administrator"
            exit 1
        }

    - name: Show System Specifications
      run: |
        Write-Host "=== System Specifications ==="
        systeminfo | findstr /C:"OS Name" /C:"OS Version" /C:"System Type"
        systeminfo | findstr /C:"Total Physical Memory" /C:"Available Physical Memory"
        systeminfo | findstr /C:"Processor(s)"
        Write-Host "=========================="

    - name: Show Disk Space
      run: |
        Write-Host "=== Disk Space ==="
        Get-PSDrive -PSProvider FileSystem | Format-Table Name, Used, Free, Root
        Write-Host "=========================="

    - name: Install Software
      run: |
        Write-Host "=== Installing Software ==="
        
        # Install Google Chrome
        Write-Host "Installing Chrome..."
        $chromeInstaller = "$env:TEMP\chrome_installer.exe"
        try {
            Invoke-WebRequest "https://dl.google.com/chrome/install/latest/chrome_installer.exe" -OutFile $chromeInstaller
            Start-Process -FilePath $chromeInstaller -Args "/silent /install" -Wait
            Remove-Item $chromeInstaller -Force
            Write-Host "‚úÖ Chrome installed"
        } catch {
            Write-Host "‚ö†Ô∏è Failed to install Chrome"
        }

    - name: Create Workspace
      run: |
        Write-Host "=== Setting up Workspace ==="
        
        # Create folders
        $workspace = "C:\GitHubWorkspace"
        New-Item -ItemType Directory -Path "$workspace\Projects" -Force
        New-Item -ItemType Directory -Path "$workspace\Downloads" -Force
        New-Item -ItemType Directory -Path "$workspace\Temp" -Force
        
        # Show contents
        Get-ChildItem C:\ -Depth 1 | Format-Table Name, LastWriteTime
        Write-Host "‚úÖ Workspace ready"

    - name: Test Internet Connection
      run: |
        Write-Host "=== Testing Internet Connection ==="
        
        # Test different sites
        $sites = @("google.com", "github.com", "microsoft.com")
        foreach ($site in $sites) {
            $result = Test-NetConnection -ComputerName $site -Port 80 -InformationLevel Quiet
            Write-Host "$site : $(if($result){'‚úÖ' }else{'‚ùå'})"
        }

    - name: Show System Info
      run: |
        Write-Host "=== System Information ==="
        
        # Show network info
        Write-Host "Network Information:"
        ipconfig | findstr "IPv4"
        
        # Show user info
        Write-Host "User Information:"
        whoami

    - name: Interactive Session
      run: |
        $duration = 6
        $endTime = (Get-Date).AddHours($duration)
        
        Write-Host ""
        Write-Host "=" * 60
        Write-Host "üéØ WINDOWS 10 ADMIN SESSION"
        Write-Host "=" * 60
        Write-Host "Duration: $duration hours"
        Write-Host "System: Windows 10"
        Write-Host "Privileges: Administrator"
        Write-Host "Workspace: C:\GitHubWorkspace"
        Write-Host "=" * 60
        Write-Host "Installed Software: Chrome"
        Write-Host "Internet: Connected"
        Write-Host "=" * 60
        Write-Host ""

        $counter = 0
        while ((Get-Date) -lt $endTime) {
            $counter++
            $timeLeft = $endTime - (Get-Date)
            $hoursLeft = [math]::Round($timeLeft.TotalHours, 2)
            
            if ($counter % 5 -eq 0) {
                Write-Host "[$(Get-Date)] System Update..."
                
                # Show memory usage
                $memory = Get-WmiObject Win32_OperatingSystem
                $usedMemory = [math]::Round(($memory.TotalVisibleMemorySize - $memory.FreePhysicalMemory) / 1MB, 2)
                $totalMemory = [math]::Round($memory.TotalVisibleMemorySize / 1MB, 2)
                
                Write-Host "   Memory: $usedMemory/$totalMemory GB"
            }
            
            Write-Host "[$(Get-Date)] ‚úÖ Session Active - $hoursLeft hours remaining"
            Start-Sleep -Seconds 60
        }
        
        Write-Host "Session time ended"

    - name: Cleanup
      if: always()
      run: |
        Write-Host "Cleaning up..."
        Remove-Item "C:\GitHubWorkspace" -Recurse -Force -ErrorAction SilentlyContinue
        Write-Host "Cleanup completed"
